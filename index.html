<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>B站 UID 查詢名稱</title>
</head>
<body>
  <h2>B站 UID 查詢使用者名稱</h2>
  <textarea id="uidInput" rows="5" cols="30" placeholder="每行一個UID"></textarea><br><br>
  <button onclick="getBilibiliUsernames()">查詢名稱</button>

  <h3>結果</h3>
  <table border="1" id="resultTable">
    <tr><th>UID</th><th>名稱</th></tr>
  </table>

  <script>
    async function getBilibiliUsernames() {
      const uids = document.getElementById('uidInput').value
        .split('\n')
        .map(uid => uid.trim())
        .filter(uid => uid !== '');

      const table = document.getElementById('resultTable');
      // 清除舊資料
      table.innerHTML = '<tr><th>UID</th><th>名稱</th></tr>';

      for (let uid of uids) {
        try {
          const res = await fetch(`https://icy-queen-6150.a0910725303.workers.dev/?uid=${uid}`);
          const data = await res.json();
          const name = data.code === 0 ? data.data.name : '查詢失敗';
          const row = table.insertRow();
          row.insertCell(0).innerText = uid;
          row.insertCell(1).innerText = name;
        } catch (err) {
          const row = table.insertRow();
          row.insertCell(0).innerText = uid;
          row.insertCell(1).innerText = '請求錯誤';
        }
      }
    }
  </script>
</body>
</html>